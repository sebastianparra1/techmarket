<ion-header>
  <ion-toolbar class="header-toolbar" color="light">
    <ion-buttons slot="start">
      <ion-avatar slot="start">
        <img src="https://play-lh.googleusercontent.com/rCc1T9PFomPVLTeHgT-pIRBHco7a9UACNQOy-DQ8io-YjGXTveRm2PHqbzfhYWw6eoHI" routerLink="/home" />
      </ion-avatar>
      <div class="logo-title">TechMarket</div>
    </ion-buttons>

    <ion-buttons slot="end">
      <ion-button fill="clear" color="success" routerLink="/pagina-vendedor">Vende tus Productos</ion-button>
      <ion-button fill="clear" color="success" (click)="verTusChats()">
        <ion-icon name="chatbox-ellipses-outline" slot="start"></ion-icon>
        Ver tus chats
        <ion-badge color="danger" *ngIf="mensajeCount > 0" style="margin-left: 6px;">{{ mensajeCount }}</ion-badge>
      </ion-button>
      <ion-button fill="clear" color="success" routerLink="/login">Cerrar Sesión</ion-button>
      <ion-button fill="clear" routerLink="/carrito-de-compras" class="carrito-button">
        <img src="https://cdn-icons-png.flaticon.com/512/8762/8762418.png" alt="Carrito" style="width: 7vw; max-width: 32px; min-width: 24px; height: auto;" />
        <ion-badge color="danger" *ngIf="carritoCount > 0">{{ carritoCount }}</ion-badge>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<!-- Buscador arriba -->
<ion-searchbar
  [(ngModel)]="terminoBusqueda"
  placeholder="Buscar productos..."
  debounce="300"
  (ionInput)="filtrarProductos()"
></ion-searchbar>

<!-- Productos -->
<ion-content class="ion-padding">
  <ion-grid>
    <ion-row>
      <ion-col size="12" size-md="6" size-lg="4" *ngFor="let producto of productosFiltrados">
        <ion-card class="producto-card">
          <img [src]="producto.imagen" alt="{{ producto.nombre }}" />
          <ion-card-header>
            <ion-card-title>{{ producto.nombre }}</ion-card-title>
            <ion-card-subtitle *ngIf="producto.categoria && producto.categoria !== 'General'">
              {{ producto.categoria }}
            </ion-card-subtitle>
          </ion-card-header>
          <ion-card-content>
            <p><strong>Precio:</strong> ${{ producto.precio | number: '1.0-0' }}</p>
            <p *ngIf="producto.descripcion"><strong>Descripción:</strong> {{ producto.descripcion }}</p>
<<<<<<< HEAD
            <ion-button expand="block" color="success">
              <ion-icon name="eye" slot="start"></ion-icon>
              Observar
            </ion-button>
            <ion-button expand="block" color="success" (click)="agregarAlCarrito(producto)">
=======

            <!-- Si unidades == 0, mostrar Producto agotado en rojo -->
            <p *ngIf="producto.unidades !== undefined && producto.unidades === 0" style="color: red; font-weight: bold;">Producto agotado</p>

            <!-- Si unidades > 0, mostrar Unidades disponibles -->
            <p *ngIf="producto.unidades !== undefined && producto.unidades > 0"><strong>Unidades disponibles:</strong> {{ producto.unidades }}</p>

            <ion-button expand="block" color="success" [routerLink]="['/producto-detalle', producto.id]">
              <ion-icon name="eye" slot="start"></ion-icon>
              Observar
            </ion-button>

            <ion-button
              expand="block"
              color="success"
              (click)="agregarAlCarrito(producto)"
              [disabled]="producto.unidades !== undefined && producto.unidades === 0">
>>>>>>> a4f78e2 (escoger unidades para el producto y email con foto de producto)
              <ion-icon name="cart" slot="start"></ion-icon>
              Agregar al carrito
            </ion-button>
            <ion-button expand="block" color="success" [routerLink]="['/chat', producto.creadoPor]">
              <ion-icon name="swap-horizontal" slot="start"></ion-icon>
              Proponer Intercambio
            </ion-button>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>
